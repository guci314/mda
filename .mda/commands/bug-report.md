# /bug-report

## 描述
业务人员报告系统问题，LLM自动分析、定位并修复问题，无需技术人员介入。

## 语法
```
/bug-report issue=<问题描述> [flow=<相关流程>] [context=<上下文信息>]
```

## 参数
- `issue` (必需): 问题的自然语言描述
- `flow` (可选): 相关的业务流程名称
- `context` (可选): 额外的上下文信息（如用户类型、数据示例等）

## 功能说明

### 1. 智能问题分析
- 使用LLM理解问题描述
- 自动识别问题类型（业务逻辑、数据、流程、界面等）
- 关联到相关的PIM模型和代码

### 2. 自动定位
- 分析PIM模型中的业务规则
- 检查流程定义是否完整
- 验证数据约束是否正确
- 追踪执行日志找出异常

### 3. 智能修复
- 对于业务规则问题：更新PIM模型
- 对于流程问题：修正流程定义
- 对于数据问题：调整验证规则
- 自动生成修复代码

### 4. 验证和部署
- 自动运行相关测试
- 部署修复后的服务
- 通知业务人员验证

## 使用示例

### 示例1：业务规则问题
```bash
/bug-report issue="金牌会员下单没有打9折"
```

LLM执行过程：
1. 识别问题：折扣计算错误
2. 检查PIM：找到订单折扣规则
3. 定位原因：规则未正确执行
4. 修复：更新规则实现
5. 验证：创建测试订单确认折扣

### 示例2：流程问题
```bash
/bug-report issue="订单取消后库存没有恢复" flow="取消订单"
```

LLM执行过程：
1. 分析取消订单流程
2. 发现缺少"恢复库存"步骤
3. 更新PIM流程图
4. 重新生成代码
5. 验证库存恢复功能

### 示例3：数据验证问题
```bash
/bug-report issue="可以输入负数金额" context="创建订单时"
```

LLM执行过程：
1. 检查订单金额验证规则
2. 发现缺少正数验证
3. 在PIM中添加约束
4. 更新验证逻辑
5. 测试各种金额输入

## 问题分类和处理策略

### 业务逻辑问题
```yaml
症状：
  - 计算结果错误
  - 业务规则未执行
  - 条件判断有误

处理：
  - 分析PIM中的规则定义
  - 检查规则执行顺序
  - 修正规则表达式
```

### 流程问题
```yaml
症状：
  - 流程步骤缺失
  - 状态转换错误
  - 并发问题

处理：
  - 检查流程图完整性
  - 验证状态机定义
  - 添加并发控制
```

### 数据问题
```yaml
症状：
  - 数据验证失败
  - 数据不一致
  - 查询结果错误

处理：
  - 检查数据约束
  - 验证数据关系
  - 优化查询逻辑
```

### 界面问题
```yaml
症状：
  - 显示错误
  - 操作无响应
  - 布局问题

处理：
  - 检查UI定义
  - 验证数据绑定
  - 调整布局配置
```

## 高级功能

### 1. 问题学习
系统会记录所有问题和解决方案，用于：
- 预防类似问题
- 优化PIM模板
- 改进生成策略

### 2. 批量修复
```bash
/bug-report issue="所有列表页都没有分页" scope=all
```

### 3. 问题预防
```bash
/bug-report analyze=true  # 主动分析潜在问题
```

## 反馈机制

修复完成后，系统会：
1. 生成修复报告
2. 提供测试链接
3. 等待业务人员确认
4. 记录修复效果

```
🔧 问题修复报告
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
问题：金牌会员下单没有打9折
状态：✅ 已修复

修复内容：
1. 更新了订单折扣计算规则
2. 添加了会员等级验证
3. 增加了折扣计算测试

验证步骤：
1. 登录测试账号（金牌会员）
2. 创建订单查看折扣
3. 确认折扣为0.9

测试地址：http://localhost:8000/test/order-discount
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 与其他命令的协作

- `/pim-assistant`: 如果问题需要修改PIM模型
- `/flow-test`: 验证修复后的流程
- `/deploy-pim`: 重新部署服务
- `/mda-troubleshooting`: 查看类似问题的解决方案

## 配置选项

在`.mda/config.yml`中配置：

```yaml
bug_report:
  auto_fix: true          # 是否自动修复
  require_approval: false # 是否需要批准
  test_before_deploy: true # 部署前测试
  notification:
    email: business@company.com
    webhook: https://...
```

## 注意事项

1. **描述要具体**：提供详细的问题描述和复现步骤
2. **指定流程**：如果知道相关流程，请指定
3. **提供示例**：如有问题数据，请提供示例
4. **及时验证**：收到修复通知后及时验证

## 未来增强

1. **智能问题预测**：基于历史数据预测潜在问题
2. **自动回归测试**：每次修复后运行完整测试套件
3. **多语言支持**：支持中英文问题描述
4. **可视化分析**：问题分布和趋势图表