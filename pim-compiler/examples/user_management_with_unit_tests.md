# 用户管理系统

## 系统描述
一个完整的用户管理系统，支持用户注册、登录、权限管理等功能。

## 业务实体

### 用户
系统的核心实体，代表使用系统的人员。
- 用户名（必填，唯一）- 用于登录的唯一标识
- 邮箱（必填，唯一）- 用户的电子邮件地址
- 密码（必填）- 加密存储的登录密码
- 姓名（必填）- 用户的真实姓名
- 手机号 - 用户的手机号码
- 状态（必填）- 用户状态：激活、禁用、待验证
- 注册时间（必填）- 用户注册的时间

## 业务服务

### 用户服务
处理用户相关的业务操作。

#### 操作列表
- 注册用户 - 创建新用户账号
- 用户登录 - 验证用户身份并生成令牌
- 修改密码 - 更新用户密码
- 更新用户信息 - 修改用户基本信息

## 业务规则

1. 密码规则
   - 密码长度至少8位
   - 必须包含大小写字母和数字
   - 密码必须加密存储

2. 用户名规则
   - 用户名长度3-20个字符
   - 只能包含字母、数字和下划线
   - 必须以字母开头

3. 邮箱规则
   - 必须是有效的邮箱格式
   - 注册时需要邮箱验证

## 单元测试

### 实体测试

#### 测试：用户实体验证
- 测试用户名验证
  - 输入：空用户名 → 期望：验证失败
  - 输入：用户名 "ab" （太短）→ 期望：验证失败
  - 输入：用户名 "valid_user123" → 期望：验证成功
  - 输入：用户名 "123start" （数字开头）→ 期望：验证失败
  
- 测试邮箱验证
  - 输入：空邮箱 → 期望：验证失败
  - 输入："invalid-email" → 期望：验证失败
  - 输入："user@example.com" → 期望：验证成功
  
- 测试密码验证
  - 输入："short" → 期望：验证失败（太短）
  - 输入："alllowercase" → 期望：验证失败（无大写字母和数字）
  - 输入："ValidPass123" → 期望：验证成功

### 服务测试

#### 测试：用户注册
- 测试正常注册
  - 准备：清空测试数据库
  - 输入：有效的用户数据
  - 期望：用户创建成功，返回用户ID
  - 验证：数据库中存在该用户，密码已加密
  
- 测试重复用户名
  - 准备：创建用户 "existing_user"
  - 输入：相同用户名的新用户
  - 期望：抛出 "用户名已存在" 异常
  
- 测试重复邮箱
  - 准备：创建邮箱为 "test@example.com" 的用户
  - 输入：相同邮箱的新用户
  - 期望：抛出 "邮箱已被注册" 异常

#### 测试：用户登录
- 测试成功登录
  - 准备：创建激活状态的测试用户
  - 输入：正确的用户名和密码
  - 期望：返回访问令牌，令牌有效期24小时
  
- 测试密码错误
  - 准备：创建测试用户
  - 输入：正确用户名，错误密码
  - 期望：抛出 "用户名或密码错误" 异常
  
- 测试账号禁用
  - 准备：创建禁用状态的用户
  - 输入：正确的凭据
  - 期望：抛出 "账号已被禁用" 异常

#### 测试：修改密码
- 测试成功修改
  - 准备：创建测试用户，记录原密码哈希
  - 输入：用户ID、旧密码、新密码
  - 期望：密码更新成功
  - 验证：新密码哈希与原哈希不同，可用新密码登录

### 集成测试

#### 测试：完整注册流程
- 步骤：
  1. 调用注册接口创建用户
  2. 验证返回的用户ID
  3. 查询数据库确认用户存在
  4. 尝试使用新用户登录
  5. 验证登录令牌有效
- 期望：所有步骤成功完成

## 测试配置

### 测试框架
- 单元测试框架：根据目标平台选择（pytest、JUnit、Jest等）
- 模拟框架：用于模拟外部依赖
- 测试数据库：使用内存数据库或测试专用数据库

### 测试覆盖率要求
- 最低覆盖率：80%
- 关键业务逻辑覆盖率：100%

### 测试命名规范
- 测试方法名：test_<被测方法>_<场景>_<期望结果>
- 示例：test_register_user_with_duplicate_username_throws_exception