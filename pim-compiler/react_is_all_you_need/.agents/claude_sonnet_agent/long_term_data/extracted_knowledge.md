# 知识库

## 元知识
- **项目架构分析方法**：从README开始 → 查看目录结构 → 核心代码文件 → 架构文档 → 路线图，形成完整理解
- **代码库理解策略**：先看包结构分层，再看入口文件和核心模块，最后查看配置和工具系统
- **架构文档查找**：在docs目录下搜索architecture相关文件，结合ROADMAP了解设计方向
- **分层架构验证**：通过package.json依赖关系和import语句验证层级关系
- **技术文档创建方法**：基于架构理解创建结构化技术文档，使用中文表达复杂概念更清晰
- **架构设计理念解释方法**：从分层结构开始 → 核心模式识别 → 设计哲学提炼 → 优势总结，形成完整的架构理解框架
- **记忆机制文档化方法**：从架构层次到实现细节，结合使用示例和最佳实践，创建完整的技术文档
- **架构理念阐述策略**：从具体分层到抽象理念，结合设计哲学和技术选择，形成完整的架构解释体系
- **技术文档结构化方法**：概述 → 架构设计 → 实现细节 → 使用示例 → 最佳实践 → 未来发展的完整章节组织
- **架构理念综合分析法**：从技术实现层面上升到设计哲学层面，通过分层架构、核心模式、设计原则、价值观念的递进分析，形成完整的架构理念体系
- **架构设计理念表达方法**：通过分层模块化、AI Agent模式、工具生态、记忆管理、安全设计、容错机制等维度全面阐述架构理念
- **技术文档创建流程**：基于已有知识理解 → 结构化组织内容 → 中文表达技术概念 → 保存到工作目录，形成完整的技术文档
- **记忆机制专题文档创建方法**：从三层架构到具体实现，包含核心机制、使用指南、安全隐私、未来发展的完整技术文档结构

## 原理与设计
- **分层模块化架构**：CLI层(用户交互) → Core层(业务逻辑) → Tools层(功能扩展)，实现关注点分离
- **AI Agent架构模式**：对话式交互 + 工具调用能力 + 上下文感知 + 自主决策
- **可扩展工具生态**：内置工具 + 命令行工具发现 + MCP协议支持，通过ToolRegistry统一管理
- **智能内存管理**：分层内存系统 + 自动压缩机制 + 环境感知
- **三层记忆架构**：会话记忆(短期对话) + 工作记忆(项目上下文) + 长期记忆(用户偏好)
- **记忆压缩策略**：重要性评分 + 时间衰减 + 语义聚合 + 频率统计，智能管理内存使用
- **环境感知机制**：项目上下文自动识别 + 工具使用模式学习 + 用户偏好适应
- **流式处理设计**：实时响应显示 + 工具执行反馈 + 用户确认机制
- **多模态认证**：OAuth + API Key + Cloud Shell + Vertex AI多种认证方式
- **安全沙箱机制**：Docker/Podman沙箱 + 权限控制 + 批准模式
- **容错降级机制**：API重试 + 模型降级 + 错误恢复
- **设计哲学**：简单而强大、模块化可扩展、智能化、用户中心、开放生态
- **AI工作流平台理念**：不仅是CLI工具，而是完整的AI工作流平台，支持从简单查询到复杂多模态应用生成
- **统一工具接口设计**：所有工具继承BaseTool基类，保证接口一致性和可扩展性
- **动态工具发现机制**：自动发现和注册工具，支持运行时扩展
- **记忆隐私保护**：本地存储 + 加密机制 + 访问控制，保护用户数据安全
- **开放生态理念**：支持第三方工具和服务集成，遵循标准化接口协议
- **高可用性设计**：多层容错机制确保系统稳定性和用户体验连续性
- **记忆机制核心理念**：智能化内存管理，通过分层架构、自动压缩、环境感知实现高效的上下文管理
- **记忆系统设计原则**：性能优化 + 隐私保护 + 用户体验，平衡内存使用与功能完整性
- **单一职责原则应用**：每层都有明确的边界和职责，便于维护和扩展
- **优雅降级设计理念**：API重试 + 模型降级 + 错误恢复，确保持续服务能力
- **架构核心价值观**：简单性(用户界面简洁) + 强大性(功能丰富) + 模块化(清晰边界) + 智能化(AI驱动) + 用户中心(体验优先) + 开放生态(标准协议)
- **混合架构优势**：单体应用的简单性 + 插件化的扩展性，统一工具接口 + 多样化工具实现，本地隐私保护 + 云端AI能力
- **关注点分离原则**：分层架构中每层专注特定职责，CLI层专注用户交互，Core层提供业务逻辑，Tools层实现功能扩展
- **记忆检索机制设计**：语义搜索 + 时间过滤 + 标签分类，支持智能化的上下文检索
- **记忆安全架构**：AES-256加密 + 本地存储 + 访问控制，确保用户数据隐私安全

## 接口与API
- **核心导出模块**：config、client、contentGenerator、geminiChat、logger、prompts、tokenLimits、turn、geminiRequest、coreToolScheduler
- **工具注册接口**：`ToolRegistry.discoverTools()` - 动态发现和注册工具
- **流式消息接口**：`sendMessageStream(request, signal, prompt_id)` - 返回AsyncGenerator
- **内容生成配置**：`ContentGeneratorConfig` + `createContentGeneratorConfig()`
- **认证类型枚举**：`AuthType` - 支持多种认证方式
- **用户层级**：`UserTierId` - 不同用户权限级别
- **工具基类**：`BaseTool`、`Tool`、`ToolResult` - 工具开发接口
- **MCP工具**：`DiscoveredMCPTool` - Model Context Protocol工具接口
- **文件操作工具**：`write_file` - 支持创建和写入文件到工作目录
- **工具管理器**：`ToolManager` - 统一管理各种工具的调用和执行
- **记忆管理接口**：`memoryTool` - 管理分层记忆系统，支持存储、检索、压缩操作
- **记忆存储格式**：JSON结构化存储，支持元数据标记和版本控制
- **记忆API接口**：存储记忆、检索记忆、压缩记忆、清理记忆等核心操作接口

## 实现细节（需验证）
- **项目结构**：packages/cli(用户界面) + packages/core(核心逻辑) + packages/vscode-ide-companion
- **CLI入口**：packages/cli/src/gemini.tsx - React + Ink渲染
- **核心客户端**：packages/core/src/core/client.js - Gemini API客户端
- **聊天逻辑**：packages/core/src/core/geminiChat.js - 多轮对话管理
- **工具系统**：packages/core/src/tools/ - 工具注册和管理
- **配置系统**：packages/core/src/config/config.js - 多层级配置
- **MCP实现**：packages/core/src/mcp/ - Model Context Protocol
- **架构文档**：docs/architecture.md - 详细架构说明
- **沙箱工具**：packages/cli/src/utils/sandbox.js - 容器化执行
- **内置工具集**：LSTool、ReadFileTool、GrepTool等在tools目录下
- **记忆机制实现**：通过memoryTool管理分层记忆，支持自动压缩和上下文感知
- **记忆存储位置**：可能在用户配置目录或项目本地目录，支持本地文件系统存储
- **安全配置**：macOS沙箱配置文件，支持不同安全级别
- **记忆数据结构**：分层JSON存储，包含会话记忆、工作记忆、长期记忆三个层级
- **记忆压缩实现**：基于重要性评分和时间衰减的自动压缩算法
- 注：文件路径和具体实现可能随版本更新变化，使用前需验证

## 用户偏好与项目特点
- **开源项目特征**：Google官方维护，Apache 2.0许可证，活跃的CI/CD流程
- **技术栈偏好**：TypeScript + Node.js + React(Ink) + Vitest测试框架
- **代码质量要求**：ESLint配置、Prettier格式化、完整的测试覆盖
- **文档完整性**：README + 架构文档 + 贡献指南 + 路线图齐全
- **容器化支持**：Dockerfile + Makefile，支持标准化部署
- **开发工具集成**：VSCode配置、GitHub Actions、集成测试套件
- **中文文档偏好**：对于复杂技术概念，用户偏好使用中文创建技术文档
- **文档命名规范**：使用描述性中文名称，如"项目名_功能模块.md"格式
- **架构解释偏好**：喜欢从设计理念到具体实现的完整架构解释，包含设计哲学和优势分析
- **多平台兼容性要求**：支持多种操作系统和认证方式，体现开放性设计理念
- **技术文档结构偏好**：包含概述、架构设计、实现细节、使用示例、最佳实践、未来发展等完整章节
- **记忆机制关注点**：重视隐私保护、性能优化、用户体验，关注记忆系统的智能化和自动化特性
- **架构理念表达偏好**：喜欢从具体技术实现上升到抽象设计哲学，形成完整的理念体系阐述
- **技术文档创建偏好**：倾向于创建详细的中文技术文档，包含完整的技术分析和实践指导
- **架构分析深度偏好**：喜欢深入的架构理念分析，包含设计哲学、核心价值观、技术优势和业务价值的全面阐述
- **理念体系化偏好**：倾向于将技术架构上升到设计哲学层面，形成完整的理念体系和价值观表达
- **架构设计理念阐述偏好**：喜欢通过多个维度（分层模块化、AI Agent模式、工具生态、记忆管理等）全面解释架构设计理念
- **技术文档保存偏好**：倾向于将技术分析结果保存为中文Markdown文档到工作目录，便于后续参考和分享
- **专题文档创建偏好**：对特定技术模块（如记忆机制）创建专门的详细技术文档，包含完整的技术分析和使用指导