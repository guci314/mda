```markdown
# 知识库

## 元知识
- 平台无关模型(PIM)到平台特定模型(PSM)的转换方法：通过分析PIM文档中的核心实体和业务逻辑，映射到具体技术栈实现
- 文档分析技术：通过结构化阅读提取领域概述、核心实体、业务规则等关键要素
- PIM到PSM转换验证方法：通过生成测试用例验证业务规则实现完整性
- PIM文档解析模式：优先提取实体属性定义和状态枚举值
- 实体属性提取模式：从PIM文档中识别必填/可选字段标记
- PIM文档转换优先级：先处理核心实体定义，再处理业务规则映射
- 实体属性解析顺序：先处理唯一标识符和核心业务属性，再处理辅助信息
- PSM文档生成验证模式：通过检查技术栈特定标记（如FastAPI装饰器）确认转换完整性
- PSM文档完整性验证方法：通过文件系统工具检查文件存在性和章节完整性
- 新增：文件操作验证模式：生成后必须进行存在性和完整性双重验证

## 原理与设计
- 分层架构设计：PIM(业务逻辑)与PSM(技术实现)分离原则
- 实体-关系建模：识别图书借阅系统中的核心实体(Book/Reader/BorrowRecord/ReservationRecord)及其属性
- RESTful API设计理念：基于资源的端点设计，配合标准HTTP方法
- 业务规则实现模式：信用评分规则、借阅限制与惩罚机制
- 实体状态管理设计：图书状态机设计（在架/已下架）
- 库存同步机制设计：总库存与可借数量的关联维护
- 实体属性设计规范：必填字段需包含唯一标识符和核心业务属性
- 图书实体设计原则：必须包含库存同步机制和状态转换约束
- PSM文档结构规范：必须包含领域模型、服务层、REST API设计、应用配置和测试规范五个核心章节
- PSM生成流程设计：先读取PIM文件，按章节转换，最后验证输出文件
- 新增：状态枚举设计规范：必须使用Python Enum类实现业务状态定义

## 接口与API
- FastAPI实现模式：
  - SQLAlchemy模型定义规范
  - Pydantic数据验证模式
  - JWT认证接口标准
- 核心API类别：
  - 资源管理端点(CRUD)
  - 业务操作端点(借阅/归还/续借/预约)
  - 查询端点(带分页/过滤)
- 测试接口规范：
  - 单元测试验证逻辑
  - 核心工作流集成测试
- 实体属性验证接口：必填字段验证、唯一约束检查
- 状态转换接口：图书下架/恢复操作端点
- 库存管理接口：可借数量与总库存的同步更新机制
- 图书状态转换接口：需包含库存数量校验逻辑
- PSM文档验证接口：通过文件内容扫描确认技术栈标记存在性
- 文件系统操作接口：包括文件读取、写入和存在性检查
- 新增：枚举类型接口规范：必须继承str和Enum实现可序列化枚举

## 实现细节（需验证）
- 可能文件结构：
  - `models/`: 存放SQLAlchemy实体定义
  - `schemas/`: 存放Pydantic模型
  - `api/`: 存放路由控制器
  - `services/`: 存放业务逻辑
  - `tests/`: 分层测试目录
- 典型代码模式：
  - 数据库会话依赖注入
  - 事务边界管理装饰器
  - 统一错误处理中间件
- 部署架构：
  - 技术栈组合(FastAPI+PostgreSQL+Redis)
  - Docker-compose容器化配置
- 实体字段实现模式：
  - 枚举状态字段实现方案
  - 库存数量同步机制
  - 必填字段实现：数据库NOT NULL约束与Pydantic验证组合
- 核心实体实现模式：图书实体需包含状态转换方法和库存同步逻辑
- 图书实体实现细节：状态转换需触发库存更新事件
- PSM文档生成实现：需包含FastAPI装饰器(@app.get等)和Pydantic模型定义
- PSM文件生成流程实现：先内存构建完整文档结构再写入文件系统
- 新增：枚举类实现细节：必须同时继承str和Enum以支持JSON序列化

## 用户偏好与项目特点
- 文档驱动开发模式：优先编写PIM文档再生成PSM
- 技术栈倾向：Python + FastAPI + SQLAlchemy组合
- 强调验证机制：包括数据校验和业务规则校验
- 测试策略：分层测试覆盖验证逻辑和工作流
- 实体属性规范：必填/可选字段明确标注
- 状态管理偏好：使用显式状态机而非隐式状态转换
- 转换优先级：实体定义完整度优先于业务规则细节
- 实体属性处理顺序：标识符>核心属性>辅助信息
- PSM文档结构偏好：五章节结构（领域模型/服务层/REST API/应用配置/测试规范）
- 文件操作偏好：生成后必须进行存在性和完整性验证
- 新增：枚举实现偏好：必须支持直接字符串序列化
```