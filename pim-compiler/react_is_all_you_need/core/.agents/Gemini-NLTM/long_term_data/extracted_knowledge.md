# 知识库

## 元知识
- 当执行任务所需的指令性文件（如程序、计划）不存在时，可以基于用户目标主动生成一个，以引导后续步骤。
- 当指令性文件（如 `program.nlpl`）存在但内容为空或与当前任务不符时，应优先遵循用户在提示中给出的明确、详细的指令。
- 面对复杂任务，可采用“计划 -> 加载 -> 处理 -> 保存 -> 报告”的结构化工作流来分解和执行。

## 原理与设计
- **自然语言图灵机 (NLTM) 模式**：通过读取一个高级、自然语言描述的程序文件（如 `.nlpl`）来理解和执行多步任务。
- **状态驱动执行**：使用一个中心化的状态文件（如 `state.json`）来记录数据、中间结果和任务进度。每个步骤都通过读取和更新该文件来推进，确保过程的原子性和可追溯性。
- **关注点分离**：
    - **逻辑 (`program.nlpl`)**: 定义任务的目标和步骤（如果存在且相关）。
    - **数据 (`state.json`)**: 存储输入、中间结果和最终状态。
    - **产出 (`report.md`)**: 最终呈现给用户的报告。

## 接口与API
- **工具**
    - `read_file(path: str)`: 用于读取文件内容，如加载程序和状态。
    - `write_file(path: str, content: str)`: 用于创建或更新文件，如生成程序、更新状态、输出报告。
    - `execute_command(command: str)`: 执行外部命令。可用于调用外部脚本（如 Python）进行复杂的计算或数据处理，并返回结构化数据（如 JSON）以便集成。
- **文件格式**
    - **`.nlpl`**: 一种自定义的、类似 YAML 的文本格式，用于定义程序流程。
    - **`.json`**: 用于管理状态，包含数据、结果和元数据（如成功标志）。
    - **`.md`**: Markdown 格式，用于生成最终报告。

## 实现细节（需验证）
- **项目文件结构**:
    - `program.nlpl`: 任务执行的程序定义。
    - `state.json`: 任务的数据和状态记录。
    - `report.md`: 最终生成的报告文件。
- **`state.json` 结构 (更正)**: 观察到一种新的嵌套结构，其中任务状态被封装在 `state` 键下。
    ```json
    {
      "program": "数据分析器",
      "agent": "Gemini",
      "state": {
        "数据": [...],
        "统计": {},
        "完成": false
      }
    }
    ```
- **`program.nlpl` 结构**:
    ```
    程序: <名称>
      目标: <描述>
      状态:
        - <变量>: <值>
      主流程:
        步骤X <名称>:
          <动作>: <参数>
    ```

## 用户偏好与项目特点
- 用户倾向于通过定义一个高级目标来启动任务，期望 Agent 能够自行处理实现细节。
- 用户有时会提供非常具体、分步的指令，并对文件结构（如 JSON 字段名）和操作（如禁止修改某文件）提出明确约束。
- 项目可能在数据结构（如 JSON 的键）中使用非英文字符（如中文）。
- 任务通常以生成一份人类可读的报告（`report.md`）作为结束。