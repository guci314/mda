# ADR-001: 废除 World Overview，采用统一环境认知

## 状态
已接受

## 日期
2024-12-14

## 背景
当前系统中存在两套并行的机制：
1. **World Overview**：Agent 初始化时自动生成的静态环境描述文件
2. **长期记忆**：Agent 执行任务时动态积累的主观经验

这导致了：
- 功能重叠和信息冗余
- 维护两套系统的复杂度
- 静态信息容易过时
- 违反了"知识即程序"的核心理念

## 决策
废除独立的 `world_overview.md` 生成机制，将环境认知整合到动态记忆系统中。

## 理由

### 支持废除的核心论点

1. **认知一致性**
   - 人类不会在进入新环境时先写概览文档
   - 我们通过探索和使用来理解环境
   - 主观认知自然包含客观信息

2. **架构简洁性**
   - 消除了两套系统的复杂度
   - 统一的知识管理接口
   - 减少了代码维护负担

3. **知识即程序**
   - World Overview 是静态数据，违反了核心理念
   - 环境理解应该是动态能力，而非静态存储
   - 通过实际使用来构建理解

4. **更好的准确性**
   - 基于实际访问的理解更准确
   - 避免了预设假设的错误
   - 知识随使用自然更新

## 实施方案

### 新的环境认知层
```
long_term_data/
├── environment/          # 环境认知（新增）
│   ├── workspace.md     # 工作空间理解
│   ├── file_purposes.md # 文件用途映射  
│   └── project_nature.md # 项目性质推断
├── methods/             # 方法层
├── principles/          # 原理层
└── experiences/         # 经验层
```

### 关键变更

1. **删除的代码**
   - `WorldOverviewChecker` 类
   - `_check_world_overview()` 方法
   - `enable_world_overview` 配置项

2. **新增的代码**
   - `EnvironmentCognition` 类
   - 工具使用时的环境学习钩子
   - 环境认知的持久化机制

3. **修改的流程**
   - Agent 初始化不再生成 world_overview
   - 文件访问时触发环境学习
   - 长期记忆更新时包含环境认知

## 影响

### 正面影响
- ✅ 简化了系统架构
- ✅ 提高了环境理解的准确性
- ✅ 减少了维护成本
- ✅ 更符合人类认知模式

### 潜在风险
- ⚠️ 冷启动时环境理解较少
  - 缓解：首次任务可以包含环境探索
- ⚠️ 需要迁移现有 Agent 的数据
  - 缓解：提供迁移脚本

## 后续行动

1. 实现 `EnvironmentCognition` 类
2. 修改 Agent 初始化逻辑
3. 在工具使用时添加学习钩子
4. 编写迁移脚本
5. 更新相关文档

## 参考
- [统一环境认知设计](./unified_environment_cognition.md)
- [环境认知实现示例](./environment_cognition_implementation.py)
- 原始讨论：用户提出"既然有了主观的长期记忆，还保留一个客观的world overview是不是过度设计了？"