# experience.md的本质：归纳的知识，不是日志

## 重要纠正

**experience.md在先验层，不在后验层！**

它记录的是：
- 类型层的知识（如"人有两只脚且无羽毛"）
- 从实例推导出的规律（如"辛普森案→程序正义"）

## 错误理解 vs 正确理解

### ❌ 错误：把experience.md当作日志

```markdown
# experience.md（错误的理解）
- 2024-01-01 10:30: 创建了order_agent
- 2024-01-01 11:00: 处理了订单#123
- 2024-01-01 11:30: 调用了库存API
```

这是后验层的执行记录，不应该在experience.md！

### ✅ 正确：experience.md是知识结晶

```markdown
# experience.md（正确的理解）
## 订单处理的归纳知识
- 电商订单必须验证库存可用性
- 大批量订单应分批处理以避免超时
- 支付失败时需要释放预留库存

## Agent创建的模式
- 订单类Agent通常需要配套的库存Agent
- 金融类Agent必须包含审计日志功能
- 数据处理Agent应支持断点续传
```

这是从具体经验中归纳出的**类型知识**！

## 三层知识体系的正确理解

### 都在先验层（A Priori）

1. **knowledge/*.md** - 共享标准库
   ```markdown
   # 像Python的pandas库
   - 所有Agent都能用的知识
   - 领域无关的通用知识
   ```

2. **agent_knowledge.md** - 能力定义
   ```markdown
   # 像类的方法定义
   - 这个Agent能做什么
   - 具体的功能实现
   ```

3. **experience.md** - 归纳的知识
   ```markdown
   # 像最佳实践文档
   - 从经验中总结的规律
   - 类型化的认知模式
   ```

### 后验层（A Posteriori）是什么？

- **messages** - 对话的具体内容
- **compact.md** - 事件流的压缩
- **ExecutionContext** - 当前执行状态
- **日志文件** - 具体的执行记录

这些才是"发生了什么"的记录！

## 哲学类比

### 柏拉图的理念论

- **理念世界**（先验）：experience.md中的类型知识
  - "订单处理的理念"
  - "库存管理的本质"

- **现象世界**（后验）：具体的执行实例
  - "订单#123的处理过程"
  - "2024-01-01的库存扣减"

### 归纳法的体现

```
具体实例（后验） → 归纳 → 类型知识（先验）

100次订单处理 → 归纳 → "订单处理模式"
多个辛普森案 → 归纳 → "程序正义原则"
```

## 正确的更新原则

### 什么写入experience.md？

✅ **应该写入的**：
- 归纳出的模式
- 总结的规律
- 类型化的知识
- 可复用的经验

❌ **不应该写入的**：
- 具体的时间戳
- 特定的实例ID
- 一次性的事件
- 原始的日志

### 示例对比

| 具体事件（后验） | 归纳知识（先验/experience.md） |
|-----------------|--------------------------------|
| 处理订单#123失败 | 缺货订单应给出明确提示 |
| 创建了10个Agent | 复杂系统需要Agent分工 |
| API调用超时3次 | 外部服务需要重试机制 |
| 用户投诉响应慢 | 批量操作需要进度反馈 |

## 实践指导

### 从经验到知识的提炼过程

```python
def extract_knowledge(experiences):
    """
    不是简单记录，而是提炼知识
    """
    # 收集具体经验
    cases = collect_cases(experiences)

    # 识别模式
    patterns = identify_patterns(cases)

    # 归纳规律
    rules = generalize_rules(patterns)

    # 写入experience.md
    write_to_experience(rules, not cases)
```

### experience.md的正确格式

```markdown
# 订单Agent的经验知识

## 订单验证规律
- 原则：永远不要相信客户端数据
- 模式：验证应该分层进行
  1. 格式验证（语法层）
  2. 业务验证（语义层）
  3. 库存验证（资源层）

## 性能优化经验
- 发现：批量操作的临界点是100条
- 原因：数据库连接池限制
- 策略：超过100条自动分批

## 异常处理模式
- 类型1：可重试异常（网络超时）
- 类型2：业务异常（库存不足）
- 类型3：系统异常（数据库宕机）
- 原则：分类处理，避免统一catch
```

## 与agent_knowledge.md的区别

| 维度 | agent_knowledge.md | experience.md |
|------|-------------------|---------------|
| 内容 | 能力定义 | 经验知识 |
| 来源 | 设计时定义 | 运行时归纳 |
| 形式 | 功能描述 | 模式和规律 |
| 更新 | 能力变化时 | 获得新认知时 |

### 具体例子

创建库存Agent后：

**agent_knowledge.md**（能力）：
```markdown
## 扩展能力
- 可以调用库存Agent检查库存
- 可以通过库存Agent扣减库存
```

**experience.md**（知识）：
```markdown
## 系统集成经验
- 订单系统必须与库存系统实时同步
- 库存检查应该在订单确认前进行
- 预留机制可以避免超卖
```

## 核心洞察

> experience.md不是日志，是智慧的结晶。
>
> 它记录的不是"发生了什么"，而是"学到了什么"。
>
> 这是从后验经验中提炼出的先验知识。

### 最终定位

- **experience.md** = 经验主义的知识库
- **不是** execution_log.md
- **而是** learned_knowledge.md

它在先验层，因为它是知识，不是记录。