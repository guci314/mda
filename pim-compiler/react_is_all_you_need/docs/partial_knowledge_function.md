# PartialçŸ¥è¯†å‡½æ•°å®šä¹‰æœºåˆ¶

## æ ¸å¿ƒç†å¿µ

**çŸ¥è¯†å‡½æ•°æ”¯æŒpartialå®šä¹‰ï¼Œç±»ä¼¼C#çš„partial class**

åŒä¸€ä¸ªçŸ¥è¯†å‡½æ•°å¯ä»¥åœ¨å¤šä¸ªæ–‡ä»¶ä¸­å®šä¹‰ï¼Œæ ¸å¿ƒè¦æ±‚ï¼š
1. âœ… **ç­¾åä¸€è‡´**ï¼šå‚æ•°åˆ—è¡¨å®Œå…¨ç›¸åŒï¼ˆå¼ºåˆ¶éªŒè¯ï¼‰
2. âœ… **ç±»å‹ä¸€è‡´**ï¼šéƒ½æ˜¯contractæˆ–éƒ½æ˜¯softï¼ˆå¼ºåˆ¶éªŒè¯ï¼‰
3. ğŸ“ **Docstringå¯ä»¥ä¸åŒ**ï¼šå…è®¸ä»ä¸åŒè§’åº¦è§£é‡Šï¼ˆå»ºè®®æ·»åŠ é“¾æ¥ï¼‰

**è®¾è®¡å†³ç­–**ï¼š
- å‚è€ƒC#å’ŒTypeScriptï¼šä¸å¼ºåˆ¶æ³¨é‡Šä¸€è‡´ï¼Œåªè¦æ±‚ç»“æ„ä¸€è‡´
- è€ƒè™‘äººæ€§ï¼šé¿å…ç»´æŠ¤é‡å¤å†…å®¹çš„è´Ÿæ‹…
- å®ç”¨ä¸»ä¹‰ï¼šé€šè¿‡markdowné“¾æ¥å…³è”ï¼Œè€Œéå¼ºåˆ¶å¤åˆ¶
- æ ¸å¿ƒä¿è¯ï¼šç­¾åæ˜¯æ¥å£å¥‘çº¦ï¼Œå¿…é¡»ä¸¥æ ¼

> ğŸ“– **è®¾è®¡è®¨è®º**ï¼šè¯¦è§ [Partialå‡½æ•°è®¾è®¡å†³ç­–](./partial_function_design_decision.md)

## è®¾è®¡çµæ„Ÿ

### C# Partial Class

```csharp
// File1.cs
public partial class Customer
{
    public void SaveToDatabase() { ... }
}

// File2.cs
public partial class Customer
{
    public void SendEmail() { ... }
}

// ç¼–è¯‘ååˆå¹¶ä¸ºä¸€ä¸ªå®Œæ•´çš„Customerç±»
```

### çŸ¥è¯†å‡½æ•°çš„Partialå®šä¹‰

```markdown
<!-- self_awareness.md: ä¸»å®šä¹‰ï¼ˆå®Œæ•´docstringï¼‰ -->
## å¥‘çº¦å‡½æ•° @åˆ›å»ºå­æ™ºèƒ½ä½“(agent_type, domain, requirements, model, parent_knowledge)
"""
åˆ›å»ºå½“å‰Agentçš„å­Agentï¼Œå»ºç«‹çˆ¶å­ç»§æ‰¿å…³ç³»ï¼Œç¡®ä¿å­Agentå…·å¤‡ç‹¬ç«‹æ‰§è¡Œèƒ½åŠ›ã€‚

å‚æ•°:
- agent_type: str - å­Agentçš„åç§°
- domain: str - ä¸“ä¸šé¢†åŸŸ
...

è¿”å›å€¼: {...}
"""

<!-- docs/implementation.md: å¼•ç”¨å®šä¹‰ï¼ˆç®€çŸ­+é“¾æ¥ï¼‰ -->
## å¥‘çº¦å‡½æ•° @åˆ›å»ºå­æ™ºèƒ½ä½“(agent_type, domain, requirements, model, parent_knowledge)
"""
â†’ è¯¦ç»†è¯´æ˜è§: [self_awareness.md](../knowledge/self_awareness.md#å¥‘çº¦å‡½æ•°-create_subagent)

æœ¬æ–‡æ¡£æä¾›è¯¦ç»†çš„å®ç°æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ã€‚
"""

è¯¦ç»†å®ç°æ­¥éª¤...
```

**å…³é”®ç‚¹**ï¼š
- âœ… ç­¾åå®Œå…¨ç›¸åŒ
- âœ… ç±»å‹ç›¸åŒï¼ˆéƒ½æ˜¯å¥‘çº¦å‡½æ•°ï¼‰
- ğŸ“ Docstringä¸åŒï¼ˆä¸€ä¸ªå®Œæ•´ï¼Œä¸€ä¸ªç®€çŸ­+é“¾æ¥ï¼‰
- ğŸ”— é€šè¿‡é“¾æ¥å…³è”è€Œéå¤åˆ¶

## å®ç°æœºåˆ¶

### ç´¢å¼•å™¨æ”¹è¿›

```python
@dataclass
class FunctionInfo:
    name: str              # å‡½æ•°å
    path: Path             # ä¸»æ–‡ä»¶è·¯å¾„ï¼ˆç¬¬ä¸€ä¸ªå®šä¹‰ï¼‰
    docstring: str         # å‡½æ•°æè¿°
    func_type: str         # ç±»å‹
    signature: str         # å‚æ•°ç­¾å
    all_locations: list    # æ‰€æœ‰å®šä¹‰ä½ç½® â­ æ–°å¢
```

### ä¸€è‡´æ€§éªŒè¯

æ‰«æçŸ¥è¯†æ–‡ä»¶æ—¶ï¼š
1. é‡åˆ°ç¬¬ä¸€ä¸ªå®šä¹‰ â†’ æ·»åŠ åˆ°ç´¢å¼•
2. é‡åˆ°ç¬¬äºŒä¸ªå®šä¹‰ â†’ éªŒè¯ä¸€è‡´æ€§
   - âœ… ç­¾åç›¸åŒ
   - âœ… Docstringç›¸åŒ
   - âœ… ç±»å‹ç›¸åŒ
   - â†’ è®°å½•åˆ°all_locations
3. å¦‚æœä¸ä¸€è‡´ â†’ æŠ›å‡ºé”™è¯¯

```python
# éªŒè¯ç­¾åä¸€è‡´æ€§
if existing.signature != func_info.signature:
    raise ValueError(f"@{func_info.name} åœ¨å¤šä¸ªæ–‡ä»¶ä¸­çš„ç­¾åä¸ä¸€è‡´")

# éªŒè¯docstringä¸€è‡´æ€§
if existing.docstring != func_info.docstring:
    raise ValueError(f"@{func_info.name} åœ¨å¤šä¸ªæ–‡ä»¶ä¸­çš„docstringä¸ä¸€è‡´")

# éªŒè¯ç±»å‹ä¸€è‡´æ€§
if existing.func_type != func_info.func_type:
    raise ValueError(f"@{func_info.name} åœ¨å¤šä¸ªæ–‡ä»¶ä¸­çš„ç±»å‹ä¸ä¸€è‡´")

# ä¸€è‡´æ€§éªŒè¯é€šè¿‡
existing.all_locations.append(func_info.path)
```

### åŠ è½½æœºåˆ¶

ä½¿ç”¨@å‡½æ•°æ—¶ï¼Œä¼šåŠ è½½**æ‰€æœ‰å®šä¹‰ä½ç½®**çš„æ–‡ä»¶ï¼š

```python
def load_required_functions(self, message: str):
    for func_name in detected:
        func_info = self.function_index[func_name]

        # åŠ è½½æ‰€æœ‰å®šä¹‰ä½ç½®çš„æ–‡ä»¶
        for location in func_info.all_locations:
            load_file(location)
```

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ¥å£ä¸å®ç°åˆ†ç¦»

```markdown
<!-- self_awareness.md: æ¥å£å®šä¹‰ -->
## å¥‘çº¦å‡½æ•° @åˆ›å»ºå­æ™ºèƒ½ä½“(agent_type, domain, requirements, model, parent_knowledge)
"""
åˆ›å»ºå­Agentçš„å¥‘çº¦å‡½æ•°ã€‚
"""
- å‚æ•°è¯´æ˜
- è¿”å›å€¼è¯´æ˜
- å¥‘çº¦ä¿è¯

<!-- æ³¨ï¼šç›®å‰@åˆ›å»ºå­æ™ºèƒ½ä½“åªåœ¨self_awareness.mdä¸­å®šä¹‰ -->
<!-- å¦‚æœéœ€è¦åœ¨å…¶ä»–æ–‡ä»¶ä¸­å¼•ç”¨ï¼Œå¿…é¡»ä¿è¯ç­¾åå’Œdocstringå®Œå…¨ä¸€è‡´ -->
```

**å®é™…æ¡ˆä¾‹**ï¼ˆå½“å‰ç³»ç»Ÿä¸­å‘ç°çš„é‡å¤å®šä¹‰ï¼‰ï¼š
```
âŒ ä¸ä¸€è‡´çš„é‡å¤ï¼ˆä¼šå¯¼è‡´é”™è¯¯ï¼‰ï¼š
   @work_with_expert
   - work_with_expert.md: (task, expert_model)
   - KNOWLEDGE_FUNCTION_REFACTOR.md: ()  # ç­¾åä¸ä¸€è‡´ï¼

âœ… ä¸€è‡´çš„é‡å¤ï¼ˆåº”è¯¥è¿™æ ·ï¼‰ï¼š
   åŒä¸€å‡½æ•°å¦‚æœå‡ºç°åœ¨å¤šä¸ªæ–‡ä»¶ï¼Œå¿…é¡»ç­¾åå’Œdocstringå®Œå…¨ç›¸åŒ
```

### åœºæ™¯2ï¼šæ¦‚å¿µä¸å®è·µåˆ†ç¦»

```markdown
<!-- concepts.md: æ¦‚å¿µå±‚ -->
## å¥‘çº¦å‡½æ•° @è‡ªæˆ‘å®ç°(requirements_doc)
"""
Agentè‡ªæˆ‘ç¼–ç¨‹çš„æ ¸å¿ƒå¥‘çº¦ã€‚
"""
ç†è®ºåŸºç¡€å’Œè®¾è®¡ç†å¿µ

<!-- practices.md: å®è·µå±‚ -->
## å¥‘çº¦å‡½æ•° @è‡ªæˆ‘å®ç°(requirements_doc)
"""
Agentè‡ªæˆ‘ç¼–ç¨‹çš„æ ¸å¿ƒå¥‘çº¦ã€‚
"""
å®è·µæŒ‡å—å’Œå¸¸è§é—®é¢˜
```

### åœºæ™¯3ï¼šé€šç”¨ä¸é¢†åŸŸç»“åˆ

```markdown
<!-- common.md: é€šç”¨çŸ¥è¯† -->
## å‡½æ•° @loadBooks()
"""
ä»JSONåŠ è½½å›¾ä¹¦æ•°æ®ã€‚
"""
é€šç”¨çš„æ•°æ®åŠ è½½é€»è¾‘

<!-- book_domain.md: é¢†åŸŸçŸ¥è¯† -->
## å‡½æ•° @loadBooks()
"""
ä»JSONåŠ è½½å›¾ä¹¦æ•°æ®ã€‚
"""
å›¾ä¹¦é¢†åŸŸçš„ç‰¹å®šçº¦æŸå’ŒéªŒè¯
```

## ç´¢å¼•æ–‡ä»¶æ ¼å¼

```json
{
  "functions": {
    "create_subagent": {
      "name": "create_subagent",
      "path": "/path/to/self_awareness.md",  // ä¸»å®šä¹‰
      "signature": "agent_type, domain, requirements, model, parent_knowledge",
      "docstring": "åˆ›å»ºå­Agentçš„å¥‘çº¦å‡½æ•°ã€‚",
      "func_type": "contract",
      "all_locations": [  // æ‰€æœ‰å®šä¹‰ä½ç½® â­
        "/path/to/self_awareness.md",
        "/path/to/agent_fractal.md"
      ],
      "is_partial": true  // æ ‡è®°ä¸ºpartialå®šä¹‰
    }
  }
}
```

## ä¸€è‡´æ€§è¦æ±‚

### å¿…é¡»ä¸€è‡´çš„éƒ¨åˆ†

1. **å‡½æ•°ç­¾å**ï¼ˆä¸¥æ ¼åŒ¹é…ï¼‰
   ```python
   @åˆ›å»ºå­æ™ºèƒ½ä½“(agent_type, domain, requirements, model, parent_knowledge)
   # âœ… å‚æ•°é¡ºåºå’Œåç§°å¿…é¡»å®Œå…¨ç›¸åŒ
   ```

2. **Docstring**ï¼ˆä¸¥æ ¼åŒ¹é…ï¼‰
   ```python
   """åˆ›å»ºå­Agentçš„å¥‘çº¦å‡½æ•°ã€‚"""
   # âœ… ç¬¬ä¸€æ®µæè¿°å¿…é¡»å®Œå…¨ç›¸åŒ
   ```

3. **å‡½æ•°ç±»å‹**ï¼ˆä¸¥æ ¼åŒ¹é…ï¼‰
   ```python
   ## å¥‘çº¦å‡½æ•° @xxx  # éƒ½æ˜¯å¥‘çº¦
   # âœ… ä¸èƒ½ä¸€ä¸ªæ˜¯å¥‘çº¦ï¼Œä¸€ä¸ªæ˜¯è½¯çº¦æŸ
   ```

### å¯ä»¥ä¸åŒçš„éƒ¨åˆ†

- **å®ç°ç»†èŠ‚**ï¼šæ¯ä¸ªæ–‡ä»¶å¯ä»¥è¡¥å……ä¸åŒçš„å®ç°è¯´æ˜
- **ä½¿ç”¨ç¤ºä¾‹**ï¼šå¯ä»¥æä¾›ä¸åŒçš„ç¤ºä¾‹ä»£ç 
- **ä¸Šä¸‹æ–‡è¯´æ˜**ï¼šå¯ä»¥ä»ä¸åŒè§’åº¦è§£é‡Šå‡½æ•°

## éªŒè¯æŠ¥å‘Š

å¯åŠ¨Agentæ—¶çš„éªŒè¯è¾“å‡ºï¼š

```
ğŸ“š å¼€å§‹ç”ŸæˆçŸ¥è¯†å‡½æ•°ç´¢å¼•...
  âœ… Partialå®šä¹‰: @åˆ›å»ºå­æ™ºèƒ½ä½“
     ä¸»å®šä¹‰: self_awareness.md
     ä¹Ÿå‡ºç°åœ¨: agent_fractal.md
     éªŒè¯ä¸€è‡´æ€§: ç­¾åâœ“ docstringâœ“ ç±»å‹âœ“

  âŒ é”™è¯¯ï¼š@work_with_expert ç­¾åä¸ä¸€è‡´ï¼
     work_with_expert.md: (task, expert_model)
     KNOWLEDGE_FUNCTION_REFACTOR.md: ()
ValueError: çŸ¥è¯†å‡½æ•° @work_with_expert åœ¨å¤šä¸ªæ–‡ä»¶ä¸­çš„ç­¾åä¸ä¸€è‡´
```

## æœ€ä½³å®è·µ

### 1. æ¥å£å®šä¹‰ç»Ÿä¸€

åœ¨ä¸»æ–‡ä»¶ä¸­å®šä¹‰æ ‡å‡†æ¥å£ï¼š
```markdown
## å¥‘çº¦å‡½æ•° @åˆ›å»ºå­æ™ºèƒ½ä½“(agent_type, domain, requirements, model, parent_knowledge)
"""
åˆ›å»ºå­Agentçš„å¥‘çº¦å‡½æ•°ã€‚
"""
```

### 2. ä¿æŒä¸€è‡´æ€§

åœ¨å…¶ä»–æ–‡ä»¶å¼•ç”¨æ—¶ï¼Œ**å¤åˆ¶ç²˜è´´**æ¥å£å®šä¹‰ï¼š
```markdown
# âœ… æ­£ç¡®ï¼šå®Œå…¨ç›¸åŒçš„ç­¾åå’Œdocstring
## å¥‘çº¦å‡½æ•° @åˆ›å»ºå­æ™ºèƒ½ä½“(agent_type, domain, requirements, model, parent_knowledge)
"""
åˆ›å»ºå­Agentçš„å¥‘çº¦å‡½æ•°ã€‚
"""

# âŒ é”™è¯¯ï¼šä¿®æ”¹äº†ç­¾åæˆ–docstring
## å¥‘çº¦å‡½æ•° @åˆ›å»ºå­æ™ºèƒ½ä½“(name, domain, requirements)  # å‚æ•°ä¸ä¸€è‡´ï¼
"""
åˆ›å»ºä¸€ä¸ªå­Agentã€‚  # docstringä¸ä¸€è‡´ï¼
"""
```

### 3. åˆ©ç”¨partialå®šä¹‰ç»„ç»‡çŸ¥è¯†

å°†å‡½æ•°çš„ä¸åŒæ–¹é¢æ”¾åœ¨ä¸åŒæ–‡ä»¶ï¼š
- æ¥å£æ–‡ä»¶ï¼šç­¾åã€å¥‘çº¦ã€åŸºæœ¬è¯´æ˜
- æ¦‚å¿µæ–‡ä»¶ï¼šç†è®ºã€è®¾è®¡ç†å¿µã€å“²å­¦æ„ä¹‰
- å®è·µæ–‡ä»¶ï¼šç¤ºä¾‹ã€å¸¸è§é—®é¢˜ã€æœ€ä½³å®è·µ

æ¯ä¸ªæ–‡ä»¶éƒ½åŒ…å«ç›¸åŒçš„æ¥å£å®šä¹‰ï¼Œä½†è¡¥å……ä¸åŒçš„å†…å®¹ã€‚

## ä¼˜åŠ¿

### 1. çŸ¥è¯†ç»„ç»‡æ›´çµæ´»
- åŒä¸€ä¸ªå‡½æ•°å¯ä»¥åœ¨å¤šä¸ªç›¸å…³ä¸»é¢˜ä¸­å‡ºç°
- ä¸åŒè§†è§’çœ‹åŒä¸€ä¸ªå‡½æ•°

### 2. ä¿è¯ä¸€è‡´æ€§
- è‡ªåŠ¨éªŒè¯æ‰€æœ‰å®šä¹‰ä¸€è‡´
- é˜²æ­¢å®šä¹‰å†²çªå’Œæ­§ä¹‰

### 3. å®Œæ•´åŠ è½½
- ä½¿ç”¨@å‡½æ•°æ—¶åŠ è½½æ‰€æœ‰å®šä¹‰ä½ç½®
- Agentè·å¾—å®Œæ•´çš„çŸ¥è¯†

### 4. ç±»ä¼¼C# partial class
- åˆ†ç¦»å…³æ³¨ç‚¹
- å¤§å‹å®šä¹‰å¯ä»¥æ‹†åˆ†åˆ°å¤šä¸ªæ–‡ä»¶
- ä¿æŒæ¯ä¸ªæ–‡ä»¶çš„å¯è¯»æ€§

## å¯¹æ¯”å…¶ä»–è¯­è¨€

| è¯­è¨€/ç³»ç»Ÿ | æœºåˆ¶ | æœ¬ç³»ç»Ÿ |
|----------|------|--------|
| C# | partial class | partial çŸ¥è¯†å‡½æ•° |
| TypeScript | declaration merging | çŸ¥è¯†å‡½æ•°åˆå¹¶ |
| Python | ä¸æ”¯æŒ | æˆ‘ä»¬æ”¯æŒï¼ |
| Java | ä¸æ”¯æŒ | æˆ‘ä»¬æ”¯æŒï¼ |

## æ€»ç»“

é€šè¿‡å¼•å…¥partialå®šä¹‰æœºåˆ¶ï¼š
- âœ… æ”¯æŒåŒä¸€å‡½æ•°åœ¨å¤šä¸ªæ–‡ä»¶ä¸­å®šä¹‰
- âœ… å¼ºåˆ¶éªŒè¯ç­¾åå’Œdocstringä¸€è‡´æ€§
- âœ… ç´¢å¼•è®°å½•æ‰€æœ‰å®šä¹‰ä½ç½®
- âœ… è‡ªåŠ¨åŠ è½½æ‰€æœ‰ç›¸å…³æ–‡ä»¶
- âœ… ç±»ä¼¼C#çš„partial classï¼Œä½†ç”¨äºçŸ¥è¯†å‡½æ•°

è¿™è®©çŸ¥è¯†ç»„ç»‡æ›´åŠ çµæ´»ï¼ŒåŒæ—¶ä¿è¯äº†ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œæ­£ç¡®æ€§ã€‚