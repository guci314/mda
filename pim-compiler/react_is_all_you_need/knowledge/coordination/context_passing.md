# 任务间上下文传递指南

## 核心原则

在协调多个 Agent 时，必须在任务之间传递关键上下文信息，确保每个 Agent 都有足够的信息完成任务。

## 1. 提取关键信息

从子 Agent 的返回结果中提取关键信息：

### 识别模式
- `✅ 任务已完成 | 关键产出: [文件列表]`
- `已创建 [文件名]`
- `函数 [函数名] 已实现`

### 提取内容
- 文件名
- 函数/类名
- 功能描述
- 特殊要求

## 2. 构建委托消息

### 模板
```
任务：[具体任务描述]
输入：[前置任务的产出]
输出：[期望的产出物]
关键信息：
- 文件：[文件名]
- 内容：[关键内容]
- 注意：[特殊说明]
```

### 强调输出
每个委托必须明确说明期望的输出：
- **文件输出**：指定文件名和内容
- **验证输出**：测试结果、报告格式
- **执行输出**：运行结果、日志信息

### 示例

**场景1：开发后测试**
```
任务：测试日期格式化功能
输入：开发者已创建 utils.py（包含 format_date 函数）
输出：
- 测试结果报告
- test_utils.py 文件（包含测试用例）
关键信息：
- 文件：utils.py
- 函数：format_date(date_str) - 格式化日期字符串
- 预期：将 "YYYY-MM-DD" 格式化为 "Month Day, Year"
```

**场景2：创建后运行**
```
任务：运行并测试 FastAPI 服务器
输入：代码生成器已创建 server.py（FastAPI 应用）
输出：
- 服务器运行状态
- API 端点测试结果
- 错误日志（如有）
关键信息：
- 文件：server.py
- 类型：FastAPI 应用
- 端口：默认8000
```

## 3. 链式任务的上下文

对于多步骤任务，保持上下文链：

```
任务：创建用户API测试
输入：
- 步骤1产出：model.py（User 模型）
- 步骤2产出：api.py（用户API）
输出：
- test_api.py 文件
- 测试报告（CRUD操作的测试结果）
关键信息：
- 模型文件：model.py（包含 User 类）
- API文件：api.py（包含 /users 端点）
- 测试重点：创建、读取、更新、删除用户
```

## 4. 避免的错误

### ❌ 错误示例
- "测试一下"（缺少测试什么）
- "运行代码"（缺少运行哪个文件）
- "验证功能"（缺少验证什么功能）

### ✅ 正确示例
- "测试 utils.py 中的 format_date 函数"
- "运行 server.py 启动 FastAPI 服务"
- "验证 User API 的 CRUD 功能"

## 5. 特殊情况处理

### 多文件产出
如果前一个任务产生多个文件，明确指出主要文件：
```
开发者创建了多个文件：
- main.py（主程序）
- config.py（配置）
- utils.py（工具函数）
请运行 main.py 测试整体功能
```

### 隐含依赖
明确说明文件之间的依赖关系：
```
已创建 database.py 和 models.py
请创建 api.py，需要导入 models.py 中的 User 类
```