# 协调器灵活策略

## 核心理念
**目标导向**：让测试通过是最终目标，方法可以灵活。

## 调试Agent任务模板（灵活版）

```
修复错误，使所有测试通过。

错误分析：
{具体错误信息}

修复策略：
1. 优先评估修复成本
2. 选择最简单的解决方案
3. 可以修改测试文件，如果：
   - 测试本身有错误
   - 测试与架构不匹配
   - 测试期望不合理
4. 可以修改功能文件，如果：
   - 功能确实缺失
   - 存在明显bug

目标：用最小的改动让测试通过。
```

## 决策矩阵

| 错误类型 | 功能修复成本 | 测试修复成本 | 推荐方案 |
|---------|------------|------------|---------|
| 404路径错误 | 高（创建整个模块）| 低（改路径）| 修改测试 |
| 字段不匹配 | 中 | 中 | 统一命名 |
| 异步/同步不匹配 | 高（重构架构）| 低（改客户端）| 修改测试 |
| 业务逻辑错误 | 低 | 高 | 修改功能 |

## 验证成功的标准

```python
def is_success(test_output):
    # 唯一标准：没有失败的测试
    return "0 failed" in test_output
```

## 灵活处理示例

### 示例1：AsyncClient vs TestClient
```python
# 如果应用是同步的，测试应该使用：
from fastapi.testclient import TestClient
client = TestClient(app)

# 而不是强行让应用变成异步
```

### 示例2：路径调整
```python
# 如果实际路由是 /books/
# 测试应该调整为：
response = client.get("/books/")  # 不是 /api/books/
```

### 示例3：数据格式适配
```python
# 如果Schema期望某些字段，测试数据应该提供：
test_data = {
    "field1": "value1",  # 必填字段
    "field2": "value2",  # 必填字段
    # 可选字段可以省略
}
```

## 协调流程

1. **运行测试** → 获取错误
2. **分析错误** → 判断根因
3. **评估方案** → 选择最简单的
4. **执行修复** → 功能或测试
5. **验证结果** → 确认通过

## 重要提醒

- 不要教条地坚持"永不修改测试"
- 实际项目中，测试和功能都可能需要调整
- 选择总体成本最低的方案
- 保持代码的一致性和可维护性