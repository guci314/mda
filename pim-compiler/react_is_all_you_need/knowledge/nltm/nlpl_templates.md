# NLPL程序模板库

## 基础模板

### 1. 数据处理模板
```yaml
程序: 数据处理任务
  目标: 处理输入数据并生成结果
  
  状态:
    输入:
      数据: []              # 原始数据
      格式: null           # 数据格式
      来源: null           # 数据来源
    处理:
      当前索引: 0          # 处理位置
      已处理: []           # 已处理项
      错误: []             # 错误记录
    输出:
      结果: null           # 处理结果
      统计: {}             # 统计信息
      报告: null           # 生成报告
    完成: false
    
  主流程:
    步骤1_加载数据:
      动作: 从指定来源加载数据
      验证: 数据非空且格式正确
      保存到: 状态.输入.数据
      失败时: 
        - 记录错误到状态.处理.错误
        - 尝试备用数据源
    
    步骤2_数据验证:
      条件: 状态.输入.数据存在
      真分支:
        - 检查数据完整性
        - 验证数据格式
        - 记录数据规模
      假分支:
        - 设置状态.完成为true
        - 返回错误信息
    
    步骤3_批量处理:
      循环: 状态.处理.当前索引 < 数据长度
      执行:
        - 获取当前批次数据
        - 执行处理逻辑
        - 更新已处理列表
        - 递增当前索引
      批次大小: 100
      异常处理: 记录并跳过错误项
    
    步骤4_结果汇总:
      动作: 合并所有处理结果
      计算:
        - 成功数量
        - 失败数量
        - 处理时间
        - 数据质量分数
      保存到: 状态.输出.统计
    
    步骤5_生成报告:
      动作: 基于结果生成报告
      包含:
        - 执行摘要
        - 详细统计
        - 错误列表
        - 改进建议
      格式: Markdown
      保存到: 状态.输出.报告
      
    步骤6_完成:
      设置: 状态.完成 = true
      返回: 状态.输出
```

### 2. 查询分析模板
```yaml
程序: 查询分析任务
  目标: 分析查询请求并返回结果
  
  状态:
    查询:
      原始请求: null       # 用户查询
      解析结果: {}        # 解析后的查询
      参数: {}            # 查询参数
    搜索:
      候选项: []          # 搜索结果
      相关度: {}          # 相关性分数
      筛选结果: []        # 筛选后结果
    分析:
      模式: []            # 发现的模式
      洞察: []            # 关键洞察
      建议: []            # 行动建议
    响应:
      答案: null          # 最终答案
      置信度: 0           # 置信度分数
      解释: null          # 答案解释
    
  主流程:
    步骤1_解析查询:
      动作: 分析用户查询意图
      提取:
        - 关键词
        - 查询类型
        - 时间范围
        - 筛选条件
      保存到: 状态.查询.解析结果
      
    步骤2_执行搜索:
      动作: 根据解析结果搜索
      策略:
        - 全文搜索
        - 语义匹配
        - 模糊查询
      限制: 最多返回100条
      保存到: 状态.搜索.候选项
      
    步骤3_相关性评分:
      循环: 对每个候选项
      计算:
        - 文本相似度
        - 语义相关性
        - 时间相关性
        - 综合得分
      保存到: 状态.搜索.相关度
      
    步骤4_结果筛选:
      条件: 相关度 > 阈值
      动作: 选择高相关性结果
      排序: 按相关度降序
      限制: 最多10条
      保存到: 状态.搜索.筛选结果
      
    步骤5_深度分析:
      动作: 分析筛选结果
      识别:
        - 共同特征
        - 异常值
        - 趋势模式
      生成:
        - 关键洞察
        - 行动建议
      保存到: 状态.分析
      
    步骤6_生成答案:
      动作: 综合分析生成答案
      考虑:
        - 查询意图
        - 搜索结果
        - 分析洞察
      计算: 答案置信度
      生成: 答案解释
      保存到: 状态.响应
```

### 3. 决策支持模板
```yaml
程序: 决策支持任务
  目标: 基于多维度分析提供决策建议
  
  状态:
    输入:
      问题描述: null       # 决策问题
      选项列表: []        # 可选方案
      约束条件: []        # 限制条件
      偏好设置: {}        # 用户偏好
    评估:
      维度定义: []        # 评估维度
      权重分配: {}        # 维度权重
      评分矩阵: {}        # 选项评分
      风险评估: {}        # 风险分析
    决策:
      推荐方案: null      # 最佳选择
      备选方案: []        # 其他选项
      理由说明: null      # 决策依据
      置信水平: 0         # 置信度
    
  主流程:
    步骤1_问题理解:
      动作: 分析决策问题
      识别:
        - 决策目标
        - 关键因素
        - 成功标准
      验证: 信息完整性
      
    步骤2_方案识别:
      条件: 选项列表为空
      真分支: 生成可能的选项
      假分支: 验证现有选项
      保存到: 状态.输入.选项列表
      
    步骤3_维度设计:
      动作: 确定评估维度
      考虑:
        - 成本因素
        - 收益因素
        - 风险因素
        - 时间因素
        - 质量因素
      分配: 维度权重
      保存到: 状态.评估.维度定义
      
    步骤4_多维评分:
      循环: 对每个选项
      嵌套循环: 对每个维度
      执行:
        - 计算维度得分
        - 应用权重
        - 记录评分依据
      保存到: 状态.评估.评分矩阵
      
    步骤5_风险分析:
      循环: 对每个选项
      评估:
        - 实施风险
        - 机会成本
        - 潜在问题
      量化: 风险分数
      保存到: 状态.评估.风险评估
      
    步骤6_决策生成:
      动作: 综合分析生成决策
      计算: 综合得分 = 加权评分 - 风险调整
      排序: 按综合得分降序
      选择: 最高分为推荐方案
      生成: 详细的理由说明
      保存到: 状态.决策
```

### 4. 工作流协调模板
```yaml
程序: 工作流协调
  目标: 协调多个子任务的执行
  
  状态:
    任务队列:
      待执行: []          # 等待执行的任务
      执行中: []          # 正在执行的任务
      已完成: []          # 完成的任务
      失败: []            # 失败的任务
    依赖关系:
      图: {}              # 任务依赖图
      就绪: []            # 可执行任务
    资源:
      可用: {}            # 可用资源
      占用: {}            # 已占用资源
    结果:
      子结果: {}          # 各任务结果
      汇总: null          # 总体结果
      
  主流程:
    步骤1_初始化:
      动作: 构建任务依赖图
      验证: 无循环依赖
      识别: 入口任务
      保存到: 状态.依赖关系.图
      
    步骤2_调度循环:
      循环: 存在待执行或执行中任务
      执行:
        子步骤1_更新就绪队列:
          动作: 找出可执行任务
          条件: 依赖已满足且资源可用
          保存到: 状态.依赖关系.就绪
          
        子步骤2_分配任务:
          循环: 对就绪队列中每个任务
          条件: 资源足够
          动作:
            - 分配资源
            - 启动执行
            - 移至执行中队列
            
        子步骤3_监控执行:
          循环: 对执行中的任务
          检查: 执行状态
          条件分支:
            完成: 
              - 释放资源
              - 移至已完成
              - 保存结果
            失败:
              - 释放资源
              - 移至失败队列
              - 记录错误
            超时:
              - 终止任务
              - 重试或标记失败
              
    步骤3_结果汇总:
      条件: 所有任务完成或失败
      动作: 合并子任务结果
      处理: 失败任务的影响
      生成: 总体执行报告
      保存到: 状态.结果.汇总
```

### 5. 迭代优化模板
```yaml
程序: 迭代优化任务
  目标: 通过迭代改进结果质量
  
  状态:
    迭代控制:
      当前轮次: 0         # 迭代次数
      最大轮次: 10        # 最大迭代
      收敛阈值: 0.01      # 收敛条件
      已收敛: false        # 是否收敛
    优化目标:
      当前值: null        # 当前目标值
      历史值: []          # 历史记录
      最佳值: null        # 最佳结果
      改进率: 0           # 改进速度
    解决方案:
      当前解: null        # 当前方案
      候选解: []          # 候选方案
      最佳解: null        # 最佳方案
      
  主流程:
    步骤1_初始化:
      动作: 生成初始解决方案
      方法: 随机或启发式
      评估: 计算初始目标值
      保存到: 
        - 状态.解决方案.当前解
        - 状态.优化目标.当前值
        
    步骤2_迭代优化:
      循环: 未收敛且未达最大轮次
      执行:
        子步骤1_生成候选:
          动作: 基于当前解生成变体
          策略:
            - 局部搜索
            - 随机扰动
            - 梯度方向
          数量: 5个候选
          保存到: 状态.解决方案.候选解
          
        子步骤2_评估候选:
          循环: 对每个候选解
          动作: 计算目标函数值
          比较: 与当前最佳值
          
        子步骤3_选择更新:
          条件: 存在更好的候选
          真分支:
            - 更新当前解
            - 更新目标值
            - 记录改进
          假分支:
            - 调整搜索策略
            - 增加扰动幅度
            
        子步骤4_检查收敛:
          计算: 改进率 = (新值-旧值)/旧值
          条件: 改进率 < 收敛阈值
          真分支: 设置已收敛 = true
          
        子步骤5_更新迭代:
          动作: 递增当前轮次
          记录: 历史值
          
    步骤3_最终处理:
      动作: 选择历史最佳解
      验证: 解的有效性
      生成: 优化报告
      返回: 最佳解决方案
```

## 模板使用指南

### 1. 选择合适的模板
- 根据任务类型选择最接近的模板
- 可以组合多个模板的特性
- 模板只是起点，可以自由修改

### 2. 自定义修改
- 调整状态结构以适应具体需求
- 修改步骤以匹配实际流程
- 添加领域特定的逻辑

### 3. 模板组合
可以将多个模板组合使用：
```yaml
程序: 复合任务
  # 使用数据处理模板的状态结构
  状态: [参考数据处理模板]
  
  主流程:
    阶段1: [使用查询分析模板的步骤]
    阶段2: [使用决策支持模板的步骤]
    阶段3: [使用数据处理模板的步骤]
```

### 4. 性能考虑
- 大数据场景：使用批处理和流式处理
- 复杂决策：使用多级决策和剪枝
- 长流程：添加检查点和恢复机制

### 5. 错误处理增强
每个模板都可以增强错误处理：
```yaml
步骤N:
  尝试: [主要操作]
  重试: 3次，间隔递增
  失败策略:
    - 方案A: 使用备用方法
    - 方案B: 降级处理
    - 方案C: 优雅失败
  最终: 清理资源
```

## 领域特定模板

### 金融领域
- 风险评估模板
- 投资组合优化模板
- 交易执行模板

### 医疗领域
- 诊断辅助模板
- 治疗方案模板
- 病历分析模板

### 教育领域
- 学习路径规划模板
- 知识评估模板
- 个性化推荐模板

### 电商领域
- 商品推荐模板
- 库存管理模板
- 价格优化模板

这些领域模板可以基于基础模板扩展，添加领域特定的：
- 状态字段
- 处理步骤
- 验证规则
- 优化目标