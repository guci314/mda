# React Agent Minimal 架构说明

## 概述

React Agent Minimal 是一个极简的 AGI 实现，通过 React 模式和文件系统实现图灵完备的计算系统。整个核心实现仅需约 500 行代码，却实现了完整的通用智能架构。

## 核心理念

### 1. React + 文件系统 = 图灵完备

```
公式：React循环 + 无限存储 = 通用计算
```

- **React循环**：Thought-Action-Observation 提供计算能力
- **文件系统**：提供理论上无限的存储空间
- **结合**：构成完整的冯·诺依曼架构

### 2. 智能 = 压缩 + 处理 + 解压

- **压缩**：将观察转化为理解（Thought）
- **处理**：基于理解做出决策（Action）
- **解压**：将决策转化为具体行动（Tool Execution）

### 3. 认知通过笔记扩展

- **工作记忆**：滑动窗口（默认50条消息）
- **长期记忆**：通过笔记文件持久化
- **知识迁移**：通过知识文件实现经验复用

## 系统架构

### 层次结构

```
┌─────────────────────────────────────┐
│         应用层 (Application)         │
│    用户任务 / 交互接口               │
└─────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────┐
│       控制层 (Control Layer)         │
│    ReactAgentMinimal                 │
│    - 任务执行循环                    │
│    - 工具调用协调                    │
│    - 内存管理                        │
└─────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────┐
│        工具层 (Tool Layer)           │
│    Function 抽象基类                 │
│    ├── ReadFileTool                  │
│    ├── WriteFileTool                 │
│    └── ExecuteCommandTool            │
└─────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────┐
│      基础设施层 (Infrastructure)     │
│    - 文件系统 (持久化)               │
│    - LLM API (推理引擎)              │
│    - 环境配置 (.env)                 │
└─────────────────────────────────────┘
```

## 核心组件

### 1. ReactAgentMinimal

主控制器，负责：
- **任务执行**：实现 React 循环
- **内存管理**：滑动窗口机制
- **工具协调**：调用和管理工具
- **知识集成**：加载和应用知识文件

关键参数：
- `window_size`: 50 (滑动窗口大小)
- `max_rounds`: 100 (最大执行轮数)
- `model`: 支持多种 LLM (DeepSeek, Moonshot, OpenAI 等)

### 2. Function 基类

所有工具和 Agent 的抽象基类：
- **统一接口**：`execute(**kwargs)` 方法
- **OpenAI 兼容**：`to_openai_function()` 转换
- **可调用**：通过 `__call__` 实现函数式调用

### 3. 工具实现

#### ReadFileTool
- 支持分段读取大文件
- 参数：`file_path`, `offset`, `limit`

#### WriteFileTool
- 创建或覆盖文件
- 自动创建父目录
- 参数：`file_path`, `content`

#### ExecuteCommandTool
- 执行 shell 命令
- 超时保护（10秒）
- 参数：`command`

### 4. 认知模型

#### 滑动窗口机制
```python
if len(messages) > window_size:
    # 保留系统消息 + 最近N条消息
    system_messages = [m for m in messages if m["role"] == "system"]
    recent_messages = messages[len(system_messages):][-window_size:]
    messages = system_messages + recent_messages
```

#### 笔记系统（三层架构）
1. **experience.md**: 长期知识和模式
2. **task_state.md**: 当前任务状态和TODO
3. **environment.md**: 项目结构和系统架构

### 5. 知识管理

自动加载的知识文件：
- `structured_notes.md`: 三层笔记架构指导
- `system_prompt.md`: 系统提示词模板

知识文件作用：
- 提供领域知识
- 定义行为模式
- 指导决策过程

## 执行流程

### 1. 初始化阶段
```
1. 加载环境变量 (.env)
2. 检测 API 配置
3. 加载知识文件
4. 创建工具实例
5. 构建系统提示词
```

### 2. 任务执行循环
```
for round in range(max_rounds):
    1. 调用 LLM API（传递 messages + tools）
    2. 处理 LLM 响应
    3. 管理滑动窗口
    4. 执行工具调用（如果有）
    5. 检查完成条件
```

### 3. 工具调用流程
```
1. LLM 返回 tool_calls
2. 解析工具名称和参数
3. 调用对应工具的 execute 方法
4. 将结果添加到消息历史
```

## 关键特性

### 1. 环境变量自动加载
按优先级搜索 .env 文件：
1. `pim-compiler/.env` (最高优先级)
2. `react_is_all_you_need/.env`
3. 当前工作目录的 `.env`

### 2. 多 LLM 支持
自动检测并配置：
- DeepSeek (默认)
- Moonshot (Kimi)
- OpenAI
- Gemini
- Qwen

### 3. 智能内存管理
- FIFO 滑动窗口
- 保留系统提示词
- 自动触发笔记写入

### 4. 知识驱动
- 知识文件定义行为
- 无需硬编码逻辑
- 支持动态知识更新

## 设计哲学

### 1. 极简主义
- 核心代码仅 ~500 行
- 最少的抽象层次
- 直接明了的实现

### 2. 图灵完备性
- React 提供控制流
- 文件系统提供存储
- 组合实现通用计算

### 3. 知识优先
- 行为通过知识文件定义
- 代码只是执行框架
- 知识可动态更新

### 4. 实用主义
- 解决实际问题
- 不追求完美抽象
- 快速迭代改进

## 与传统架构对比

| 方面 | 传统 Agent 框架 | React Agent Minimal |
|------|----------------|-------------------|
| 代码量 | 数千到数万行 | ~500 行 |
| 复杂度 | 多层抽象，复杂继承 | 单层结构，直接实现 |
| 内存管理 | 复杂的内存系统 | 简单的滑动窗口 |
| 知识表示 | 代码中的规则 | 自然语言知识文件 |
| 扩展方式 | 编写新代码 | 添加知识文件 |
| 学习曲线 | 陡峭 | 平缓 |

## 未来展望

1. **工具扩展**：添加更多专用工具
2. **知识积累**：构建领域知识库
3. **协作机制**：多 Agent 协同
4. **性能优化**：更高效的内存管理

## 总结

React Agent Minimal 证明了：
- **AGI 不需要复杂**：500 行代码足够
- **知识驱动开发**：用自然语言编程
- **图灵完备性是关键**：React + 文件系统 = 无限可能

这不仅是一个技术实现，更是一种新的编程范式：**用知识而非代码定义智能**。