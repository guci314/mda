# 🔧 Jupyter Notebook 卡住问题解决指南

## 问题描述
选择"React Agent Environment"内核运行 `agent_research.ipynb` 时卡住。

## 可能的原因和解决方案

### 1. 内核启动超时

**症状**: 内核显示为"启动中"状态，长时间无响应

**解决方案**:
```bash
# 方法1: 使用简化的启动脚本
./start_jupyter_simple.sh

# 方法2: 手动清理并重启
pkill -f jupyter
pkill -f ipykernel
sleep 3
source ../react_agent_env/bin/activate
jupyter notebook --no-browser --port=8888
```

### 2. 依赖包冲突

**症状**: 内核启动失败或导入错误

**解决方案**:
```bash
# 重新安装关键包
source ../react_agent_env/bin/activate
pip install --upgrade ipykernel jupyter_client
python -m ipykernel install --user --name=react_agent_env --display-name="React Agent Environment"
```

### 3. 端口冲突

**症状**: Jupyter无法启动或连接失败

**解决方案**:
```bash
# 检查端口占用
lsof -i :8888

# 使用不同端口
jupyter notebook --port=8889
```

### 4. Notebook内容问题

**症状**: 特定notebook卡住，其他正常

**解决方案**:
1. 创建测试notebook验证内核
2. 逐步运行notebook中的代码
3. 检查是否有无限循环或阻塞操作

## 诊断步骤

### 步骤1: 运行诊断脚本
```bash
source ../react_agent_env/bin/activate
python fix_kernel_issue.py
```

### 步骤2: 测试简单notebook
```bash
# 使用测试notebook
jupyter notebook test_notebook.ipynb
```

### 步骤3: 检查内核状态
```bash
# 在Jupyter中运行
import sys
print(sys.executable)
print("内核工作正常")
```

## 快速修复方案

### 方案1: 完全重置
```bash
# 1. 停止所有Jupyter进程
pkill -f jupyter
pkill -f ipykernel

# 2. 重新安装内核
source ../react_agent_env/bin/activate
python -m ipykernel install --user --name=react_agent_env --display-name="React Agent Environment"

# 3. 使用简化启动脚本
./start_jupyter_simple.sh
```

### 方案2: 使用不同内核
```bash
# 临时使用系统Python内核
jupyter notebook --generate-config
echo "c.NotebookApp.kernel_spec_manager_class = 'jupyter_client.kernelspec.KernelSpecManager'" >> ~/.jupyter/jupyter_notebook_config.py
```

### 方案3: 降级Jupyter版本
```bash
# 如果是最新版本导致的问题
source ../react_agent_env/bin/activate
pip install "jupyter<7.0" "notebook<7.0"
```

## 验证修复

### 检查清单
- [ ] 内核能够正常启动
- [ ] 可以执行简单代码
- [ ] 可以导入项目依赖包
- [ ] agent_research.ipynb 可以正常运行

### 测试代码
```python
# 在notebook中运行这些代码验证
import sys
print("Python路径:", sys.executable)

import os
print("工作目录:", os.getcwd())

# 测试基本功能
print("Hello, World!")
```

## 常见错误和解决方案

### 错误1: "Kernel died"
- **原因**: 内核进程意外终止
- **解决**: 重新安装内核或检查Python环境

### 错误2: "Connection failed"
- **原因**: 网络或端口问题
- **解决**: 使用 `--ip=127.0.0.1` 或更换端口

### 错误3: "Import error"
- **原因**: 虚拟环境中缺少包
- **解决**: 在虚拟环境中安装缺失的包

## 预防措施

1. **定期清理**: 定期清理Jupyter缓存和临时文件
2. **环境隔离**: 确保使用正确的虚拟环境
3. **版本控制**: 记录工作正常的Jupyter版本
4. **备份配置**: 备份工作正常的配置文件

## 获取帮助

如果以上方案都无法解决问题，请：

1. 运行诊断脚本并保存输出
2. 检查Jupyter日志文件
3. 尝试在系统Python环境中测试
4. 考虑重新创建虚拟环境

---

**最后更新**: 2025-07-31
**适用版本**: Jupyter 7.x, Python 3.10 