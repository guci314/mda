# MDA无代码平台 - 业务专家使用手册

> 让业务专家用自然语言直接构建企业应用系统

## 快速开始

### 什么是MDA无代码平台？

这是一个让业务专家无需编程即可创建企业应用的平台。您只需要：
1. 用自然语言描述业务需求
2. 绘制业务流程图
3. 定义业务规则

系统会自动生成可运行的应用程序。

### 三步创建应用

#### 第1步：描述您的业务
创建一个YAML文件，描述您的业务领域：

```yaml
domain: 客户管理
version: 1.0.0
description: 管理客户信息和销售机会

entities:
  - name: 客户
    description: 我们的客户信息
    attributes:
      名称:
        type: string
        required: true
      联系电话:
        type: string
      行业:
        type: enum
        enum: [制造业, 零售业, 服务业, 其他]
      信用等级:
        type: enum
        enum: [A, B, C]
```

#### 第2步：运行平台
```bash
cd pim-engine
docker compose up -d
```

#### 第3步：访问您的应用
- 应用地址：http://localhost:8001
- API文档：http://localhost:8001/docs
- 调试界面：http://localhost:8001/debug/ui

## 核心概念

### 1. 实体（Entity）
实体是您业务中的核心对象，比如：
- 客户、订单、产品（销售系统）
- 患者、医生、病历（医疗系统）
- 学生、课程、成绩（教育系统）

### 2. 属性（Attribute）
实体的特征信息：
- 基础类型：文本(string)、数字(integer/decimal)、日期(datetime)、是否(boolean)
- 选择类型：枚举(enum)，如订单状态[待付款, 已付款, 已发货]
- 引用类型：关联其他实体，如订单关联客户

### 3. 服务（Service）
对实体的操作，系统会自动提供：
- 创建（新增客户）
- 查询（查找客户）
- 更新（修改信息）
- 删除（删除记录）

### 4. 业务流程（Flow）
复杂的业务操作步骤，使用流程图表示：

```yaml
flows:
  客户审批流程:
    description: 新客户注册审批
    diagram: |
      flowchart TD
        开始 --> 提交申请
        提交申请 --> 信用检查
        信用检查 -->|通过| 设置信用等级
        信用检查 -->|不通过| 拒绝申请
        设置信用等级 --> 发送欢迎邮件
        发送欢迎邮件 --> 结束
        拒绝申请 --> 结束
```

### 5. 业务规则（Rule）
用自然语言定义的业务约束：
```yaml
rules:
  信用检查: 客户注册资本必须大于100万
  等级设定: 注册资本超过1000万的客户信用等级为A
  审批权限: 信用等级A的客户由经理审批
```

## 完整示例

### 订单管理系统

```yaml
domain: 订单管理
version: 1.0.0
description: 处理客户订单的完整流程

entities:
  - name: 产品
    attributes:
      名称:
        type: string
        required: true
      价格:
        type: decimal
        required: true
      库存数量:
        type: integer
        default: 0
        
  - name: 订单
    attributes:
      订单号:
        type: string
        unique: true
        required: true
      客户名称:
        type: string
        required: true
      订单金额:
        type: decimal
      状态:
        type: enum
        enum: [待付款, 已付款, 已发货, 已完成]
        default: 待付款
      下单时间:
        type: datetime
        auto_now_add: true
        
  - name: 订单明细
    attributes:
      订单:
        type: reference
        to: 订单
        required: true
      产品:
        type: reference
        to: 产品
        required: true
      数量:
        type: integer
        required: true
      单价:
        type: decimal
        required: true

services:
  - name: 订单服务
    description: 处理订单相关业务
    methods:
      - name: 创建订单
        description: 客户下单
        parameters:
          订单信息: 订单
          明细列表: 订单明细[]
        flow: 订单处理流程
        
      - name: 订单付款
        description: 处理订单付款
        parameters:
          订单号: string
          付款金额: decimal
        flow: 付款流程

flows:
  订单处理流程:
    diagram: |
      flowchart TD
        开始 --> 验证库存
        验证库存 -->|充足| 创建订单
        验证库存 -->|不足| 提示缺货
        创建订单 --> 计算金额
        计算金额 --> 保存订单
        保存订单 --> 发送确认
        发送确认 --> 结束
        提示缺货 --> 结束
        
  付款流程:
    diagram: |
      flowchart TD
        开始 --> 查找订单
        查找订单 -->|找到| 验证金额
        查找订单 -->|未找到| 返回错误
        验证金额 -->|匹配| 更新状态
        验证金额 -->|不匹配| 返回错误
        更新状态 --> 扣减库存
        扣减库存 --> 发送通知
        发送通知 --> 结束
        返回错误 --> 结束

rules:
  库存检查: 订单数量不能超过产品库存
  金额计算: 订单金额等于所有明细的数量乘以单价之和
  付款验证: 付款金额必须等于订单金额
  库存扣减: 付款成功后扣减相应产品库存
```

## 使用流程调试器

### 1. 访问调试界面
打开浏览器访问：http://localhost:8001/debug/ui

### 2. 选择要调试的流程
从下拉列表选择您要测试的业务流程

### 3. 创建调试会话
点击"创建会话"按钮，输入测试数据

### 4. 观察执行过程
- 流程图会实时显示当前执行步骤
- 右侧显示每步的执行结果
- 可以看到业务规则的判断过程

### 5. 调试技巧
- 使用不同的测试数据验证各种场景
- 观察规则判断结果是否符合预期
- 检查流程路径是否正确

## 常用模式

### 1. 主从结构
如订单和订单明细：
```yaml
entities:
  - name: 订单
    attributes:
      订单号: string
      
  - name: 订单明细
    attributes:
      订单:
        type: reference
        to: 订单
```

### 2. 状态管理
使用枚举定义状态流转：
```yaml
状态:
  type: enum
  enum: [草稿, 待审批, 已批准, 已拒绝]
  default: 草稿
```

### 3. 审批流程
标准的审批模式：
```yaml
flows:
  审批流程:
    diagram: |
      flowchart TD
        提交 --> 审批
        审批 -->|批准| 执行
        审批 -->|拒绝| 退回
        审批 -->|需补充| 退回修改
```

### 4. 自动编号
系统自动生成的唯一编号：
```yaml
编号:
  type: string
  unique: true
  auto_generate: true
  pattern: "ORD{YYYY}{MM}{DD}{SEQ:6}"
```

## 最佳实践

### 1. 命名规范
- 使用业务术语，避免技术术语
- 实体用名词：客户、订单、产品
- 服务方法用动词：创建订单、审批申请
- 保持一致的命名风格

### 2. 流程设计
- 每个流程专注一个业务目标
- 避免过于复杂的分支
- 异常情况要有明确处理
- 使用清晰的判断条件

### 3. 规则定义
- 用简单直白的语言
- 一条规则只描述一个约束
- 避免规则之间的冲突
- 考虑各种边界情况

### 4. 数据建模
- 合理划分实体边界
- 避免过深的嵌套关系
- 必填字段要标记required
- 设置合理的默认值

## 常见问题

### Q: 如何修改已部署的系统？
A: 直接修改YAML文件，系统会自动重新加载（热更新）。

### Q: 能否导入Excel数据？
A: 可以通过API接口批量导入，或联系技术人员协助。

### Q: 如何备份业务数据？
A: 系统自动定期备份，也可以通过管理界面手动备份。

### Q: 支持多少并发用户？
A: 取决于部署配置，标准配置支持数百并发用户。

### Q: 如何添加自定义报表？
A: 在服务中定义查询方法，可以实现各类统计报表。

## 故障排除

### 服务无法访问
1. 检查Docker是否正在运行
2. 确认端口8001未被占用
3. 查看Docker日志：`docker compose logs`

### 数据保存失败
1. 检查必填字段是否完整
2. 验证数据格式是否正确
3. 查看浏览器控制台错误信息

### 流程执行异常
1. 使用调试器逐步检查
2. 验证业务规则是否冲突
3. 检查流程图是否完整

## 获取帮助

### 在线资源
- 项目文档：查看项目目录下的文档
- API文档：http://localhost:8001/docs
- 示例模型：models/目录下的示例文件

### 命令帮助
在Claude Code中使用：
- `/help` - 查看所有可用命令
- `/mda-troubleshooting` - 故障诊断助手

### 反馈问题
- GitHub Issues: https://github.com/anthropics/claude-code/issues
- 描述问题时请包含：
  - 您的业务模型文件
  - 错误信息截图
  - 操作步骤说明

## 进阶主题

### 1. 复杂数据类型
```yaml
地址:
  type: json
  schema:
    省份: string
    城市: string
    详细地址: string
```

### 2. 计算字段
```yaml
总金额:
  type: decimal
  computed: true
  formula: "单价 * 数量 * (1 - 折扣)"
```

### 3. 数据验证
```yaml
邮箱:
  type: string
  pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
  error_message: "请输入有效的邮箱地址"
```

### 4. 关联查询
```yaml
methods:
  - name: 查询客户订单
    description: 获取客户的所有订单
    parameters:
      客户ID: string
    returns: 订单[]
    query: |
      订单.客户ID = :客户ID
      ORDER BY 订单.创建时间 DESC
```

### 5. 批量操作
```yaml
methods:
  - name: 批量更新状态
    description: 批量修改订单状态
    parameters:
      订单列表: string[]
      新状态: string
    transaction: true
```

## 版本更新

### 当前版本：2.0
- PIM执行引擎架构
- 实时热更新
- 可视化流程调试
- 自然语言规则引擎

### 规划特性
- AI辅助模型设计
- 移动端支持
- 更多数据源集成
- 高级报表设计器

---

*让业务创新更简单 - MDA无代码平台*